<!doctype html>
<html lang="el">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Πάρνηθα | Διαδραστικός Χάρτης</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css">

<style>
html,body{margin:0;height:100%;background:#0b0f14;color:#e8edf6;font-family:system-ui}
#map{height:100vh;width:100vw}

/* logo */
#logo{
  position:absolute;top:12px;left:12px;z-index:500;
}
#logo img{width:10vw;max-width:120px;min-width:70px}

/* compass */
#compass{
  position:absolute;top:12px;right:12px;width:46px;height:46px;
  border-radius:50%;background:rgba(0,0,0,.55);
  display:flex;align-items:center;justify-content:center;z-index:500
}
#needle{
  width:0;height:0;border-left:7px solid transparent;
  border-right:7px solid transparent;border-bottom:18px solid red
}

/* side panel */
#panel{
  position:absolute;right:12px;bottom:12px;width:340px;
  background:#111827;border-radius:16px;padding:12px;
  z-index:500;border:1px solid rgba(255,255,255,.12)
}
button{
  padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.15);
  background:#1f2937;color:#fff;cursor:pointer;font-weight:600
}
.controls{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:8px}

/* modal */
#backdrop{
  position:fixed;inset:0;background:rgba(0,0,0,.55);
  display:none;align-items:center;justify-content:center;
  z-index:2000;
}
#modal{
  background:#020617;padding:14px;border-radius:16px;
  width:520px;max-width:95%;
  border:1px solid rgba(255,255,255,.15)
}
.field{margin-bottom:8px}
input,textarea{
  width:100%;padding:8px;border-radius:10px;
  border:1px solid rgba(255,255,255,.15);
  background:#020617;color:#fff
}
textarea{min-height:80px}

.poi-img{
  filter:drop-shadow(0 6px 10px rgba(0,0,0,.45));
  pointer-events:auto;
}
</style>
</head>

<body>

<div id="map"></div>

<div id="logo">
  <img src="./Logo%20%CE%95%CE%94%CE%A0%CE%91%20(1000%20x%201000%20px).png">
</div>

<div id="compass"><div id="needle"></div></div>

<div id="panel">
  <div class="controls">
    <button onclick="startGPS()">GPS</button>
    <button onclick="toggleFollow()">Follow</button>
    <button onclick="stopGPS()">Stop</button>
    <button onclick="openModal()">POI</button>
  </div>
  <div id="info" style="font-size:13px;color:#a6b2c5">
    Πάτα σε POI για πληροφορίες
  </div>
</div>

<div id="backdrop">
  <div id="modal">
    <b>Νέο POI</b>

    <div class="field"><input id="title" placeholder="Τίτλος"></div>
    <div class="field"><input id="coords" placeholder="lat, lng"></div>
    <div class="field"><input id="png" placeholder="agios_petros.png"></div>
    <div class="field"><textarea id="text" placeholder="Πληροφορίες"></textarea></div>

    <div class="controls">
      <button onclick="pickFromMap()">Πάρε συντεταγμένες</button>
      <button onclick="savePOI()">Save</button>
      <button onclick="closeModal()">Close</button>
    </div>
    <div id="note" style="font-size:12px;color:#fca5a5"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
/* map */
const map=L.map('map').setView([38.159,23.742],12);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

/* compass */
const needle=document.getElementById('needle');
window.addEventListener('deviceorientation',e=>{
  if(e.alpha!==null) needle.style.transform='rotate('+(360-e.alpha)+'deg)';
});

/* gps */
let follow=false,user=null;
function startGPS(){map.locate({watch:true,enableHighAccuracy:true})}
function stopGPS(){map.stopLocate()}
function toggleFollow(){follow=!follow}
map.on('locationfound',e=>{
  if(!user) user=L.circleMarker(e.latlng,{radius:6}).addTo(map);
  else user.setLatLng(e.latlng);
  if(follow) map.setView(e.latlng,16);
});

/* modal logic */
const backdrop=document.getElementById('backdrop');
function openModal(){
  backdrop.style.display='flex';
  backdrop.style.pointerEvents='auto';
}
function closeModal(){
  backdrop.style.display='none';
  backdrop.style.pointerEvents='none';
}

/* pick from map */
let picking=false;
function pickFromMap(){
  closeModal();
  picking=true;
  document.getElementById('info').innerText='Κάνε 1 κλικ στον χάρτη';
}

map.on('click',e=>{
  if(!picking) return;
  picking=false;
  document.getElementById('coords').value=
    e.latlng.lat.toFixed(6)+', '+e.latlng.lng.toFixed(6);
  openModal();
});

/* POI */
const pois=[];
function makeIcon(url,px){
  return L.divIcon({
    className:'',
    html:`<img class="poi-img" src="${url}" style="width:${px}px">`,
    iconSize:[px,px],
    iconAnchor:[px/2,px]
  });
}
function savePOI(){
  const t=title.value;
  const c=coords.value.split(',');
  const p=png.value;
  const txt=text.value;
  if(c.length!==2){note.innerText='Λάθος συντεταγμένες';return}

  const lat=parseFloat(c[0]),lng=parseFloat(c[1]);
  const m=L.marker([lat,lng],{icon:makeIcon(p,40)}).addTo(map);
  m.on('click',()=>info.innerText=txt||t);
  closeModal();
}
</script>

</body>
</html>
