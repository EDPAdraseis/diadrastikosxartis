<!doctype html>
<html lang="el">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Πάρνηθα | Διαδραστικός Χάρτης</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css">
<script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
body{margin:0;background:#0b0f14;color:#e8edf6;font-family:system-ui}
#map{height:100vh}
.panel{
  position:fixed;right:10px;top:10px;width:340px;
  background:#111827;border:1px solid rgba(255,255,255,.1);
  border-radius:14px;padding:12px;z-index:1000
}
.btn{padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.15);
background:#1f2937;color:#fff;cursor:pointer;font-weight:600}
.btn.primary{background:#166534}
.btn.danger{background:#7f1d1d}
.btn.soft{background:#1e3a8a}
.controls{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
.field{margin-top:6px}
input,textarea{
  width:100%;padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,.15);
  background:#020617;color:#fff
}
textarea{min-height:70px}
.modal{
  position:fixed;inset:0;background:rgba(0,0,0,.45);
  display:none;align-items:center;justify-content:center;z-index:2000
}
.modal.open{display:flex}
.modal-card{
  width:600px;max-width:95%;background:#020617;
  border-radius:16px;border:1px solid rgba(255,255,255,.1);padding:12px
}
.compass{
  position:absolute;left:10px;top:10px;width:50px;height:50px;
  border-radius:50%;background:rgba(0,0,0,.5);
  display:flex;align-items:center;justify-content:center;z-index:500
}
.needle{
  width:0;height:0;border-left:6px solid transparent;
  border-right:6px solid transparent;border-bottom:18px solid red
}
</style>
</head>

<body>

<div id="map"></div>

<div class="compass"><div class="needle" id="needle"></div></div>

<div class="panel" id="sidePanel">
  <b>AI Βοηθός Πάρνηθας</b>
  <div class="controls">
    <button class="btn primary" onclick="startGPS()">GPS</button>
    <button class="btn" onclick="toggleFollow()">Follow</button>
    <button class="btn danger" onclick="stopGPS()">Stop</button>
    <button class="btn" onclick="openCode()">POI (κωδικός)</button>
  </div>
  <div id="info" style="margin-top:8px;font-size:13px;color:#a6b2c5"></div>
</div>

<div class="modal" id="modal">
  <div class="modal-card">
    <b>Νέο POI</b>

    <div class="field"><input id="pid" placeholder="ID"></div>
    <div class="field"><input id="ptitle" placeholder="Τίτλος"></div>
    <div class="field"><input id="plat" placeholder="Latitude"></div>
    <div class="field"><input id="plng" placeholder="Longitude"></div>
    <div class="field"><input id="ppng" placeholder="./icons/poi.png"></div>
    <div class="field"><textarea id="pprompt" placeholder="Prompt AI"></textarea></div>

    <div class="controls">
      <button class="btn soft" onclick="pickPoint()">Πάρε συντεταγμένες</button>
      <button class="btn" onclick="preview()">Preview</button>
      <button class="btn primary" onclick="savePOI()">Save</button>
      <button class="btn danger" onclick="closeModal()">Close</button>
    </div>
  </div>
</div>

<script>
let map=L.map('map').setView([38.159,23.742],12);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

let follow=false,userMarker=null,previewMarker=null,pois=[];

function startGPS(){
  map.locate({watch:true,enableHighAccuracy:true});
}
function stopGPS(){map.stopLocate();}
function toggleFollow(){follow=!follow;}

map.on('locationfound',e=>{
  if(!userMarker) userMarker=L.marker(e.latlng).addTo(map);
  else userMarker.setLatLng(e.latlng);
  if(follow) map.setView(e.latlng,16);
});

function openCode(){
  let c=prompt("Κωδικός");
  if(c==="1234") document.getElementById('modal').classList.add('open');
}

function closeModal(){
  document.getElementById('modal').classList.remove('open');
  if(previewMarker){map.removeLayer(previewMarker);previewMarker=null}
}

function pickPoint(){
  closeModal();
  map.once('click',e=>{
    document.getElementById('plat').value=e.latlng.lat.toFixed(6);
    document.getElementById('plng').value=e.latlng.lng.toFixed(6);
    document.getElementById('modal').classList.add('open');
  });
}

function preview(){
  if(previewMarker){map.removeLayer(previewMarker)}
  let lat=+plat.value,lng=+plng.value,png=ppng.value;
  let icon=L.icon({
    iconUrl:png,
    iconSize:[48,48],
    iconAnchor:[24,48],
    errorOverlayUrl:'https://leafletjs.com/examples/custom-icons/leaf-red.png'
  });
  previewMarker=L.marker([lat,lng],{icon}).addTo(map);
  map.setView([lat,lng],15);
}

function savePOI(){
  let p={
    id:pid.value,title:ptitle.value,
    coords:[+plat.value,+plng.value],
    imageUrl:ppng.value,prompt:pprompt.value
  };
  let icon=L.icon({iconUrl:p.imageUrl,iconSize:[48,48],iconAnchor:[24,48]});
  let m=L.marker(p.coords,{icon}).addTo(map);
  m.on('click',()=>document.getElementById('info').innerText=p.prompt);
  closeModal();
}

let needle=document.getElementById('needle');
window.addEventListener('deviceorientation',e=>{
  if(e.alpha!==null) needle.style.transform='rotate('+(360-e.alpha)+'deg)';
});
</script>

</body>
</html>
