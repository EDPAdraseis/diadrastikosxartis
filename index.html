<!doctype html><html lang="el"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Πάρνηθα | Διαδραστικός Χάρτης</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/><style>:root{--bg:#0b0f14;--text:#e9eef6;--muted:#b8c3d6;--border:rgba(255,255,255,.10);--shadow:0 12px 40px rgba(0,0,0,.45);--radius:18px;--green:#1f8a5b;--red:#a33a3a;--blue:#2a65d6;--yellow:#d7b13a}html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}#app{height:100%;display:flex;gap:14px;padding:14px;box-sizing:border-box}#mapWrap{flex:1 1 auto;position:relative;border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);border:1px solid var(--border);min-width:320px}#map{height:100%;width:100%;background:#0b0f14}#logoBadge{position:absolute;top:12px;left:12px;z-index:500;display:flex;align-items:center;gap:10px;pointer-events:none}#logoBadge img{width:10vw;max-width:140px;min-width:64px;height:auto;filter:drop-shadow(0 8px 18px rgba(0,0,0,.55));opacity:.98}#compass{position:absolute;top:12px;right:12px;z-index:500;width:46px;height:46px;border-radius:999px;background:rgba(15,22,34,.72);border:1px solid var(--border);box-shadow:var(--shadow);display:grid;place-items:center;backdrop-filter:blur(10px);user-select:none;pointer-events:none}#compass .needle{width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:18px solid #ff4a4a;transform-origin:50% 75%;transform:rotate(0deg);filter:drop-shadow(0 4px 10px rgba(0,0,0,.5))}#side{width:360px;max-width:42vw;background:linear-gradient(180deg,rgba(15,22,34,.98),rgba(10,16,26,.98));border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px;box-sizing:border-box;display:flex;flex-direction:column;gap:12px;overflow:hidden}#sideHeader{display:flex;align-items:center;justify-content:space-between;gap:10px}#sideHeader h2{margin:0;font-size:16px;letter-spacing:.2px}#statusPill{font-size:12px;color:var(--muted);border:1px solid var(--border);padding:6px 10px;border-radius:999px;background:rgba(0,0,0,.18)}.hint{color:var(--muted);font-size:12.5px;line-height:1.35}.row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}button{appearance:none;border:1px solid var(--border);background:rgba(0,0,0,.18);color:var(--text);padding:10px 12px;border-radius:12px;cursor:pointer;font-weight:600;font-size:13px;transition:transform .08s ease,background .12s ease}button:hover{background:rgba(255,255,255,.06)}button:active{transform:scale(.99)}.btn-green{background:rgba(31,138,91,.25);border-color:rgba(31,138,91,.45)}.btn-red{background:rgba(163,58,58,.25);border-color:rgba(163,58,58,.45)}.btn-blue{background:rgba(42,101,214,.20);border-color:rgba(42,101,214,.45)}.btn-yellow{background:rgba(215,177,58,.18);border-color:rgba(215,177,58,.40)}.chip{display:flex;align-items:center;gap:8px;padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:rgba(0,0,0,.16);font-size:13px;color:var(--text);user-select:none}.chip input{transform:translateY(1px)}#aiBox{flex:1 1 auto;overflow:auto;border-radius:14px;border:1px solid var(--border);padding:12px;background:rgba(0,0,0,.14)}#aiBox .title{font-weight:700;margin-bottom:8px}#aiBox .msg{color:var(--muted);font-size:13px;line-height:1.45;white-space:pre-wrap}#modalBackdrop{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:2000;backdrop-filter:blur(2px);pointer-events:none}#modal{width:min(560px,92vw);background:rgba(15,22,34,.98);border:1px solid var(--border);border-radius:18px;box-shadow:var(--shadow);padding:14px;box-sizing:border-box}#modalHeader{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px}#modalHeader h3{margin:0;font-size:15px}#closeModal{font-size:14px;padding:8px 10px;border-radius:10px}.field{display:flex;flex-direction:column;gap:6px;margin:10px 0}.field label{font-size:12px;color:var(--muted)}.field input,.field textarea{width:100%;box-sizing:border-box;background:rgba(0,0,0,.22);border:1px solid var(--border);border-radius:12px;padding:10px 12px;color:var(--text);outline:none;font-size:13px}.field textarea{min-height:90px;resize:vertical}.smallnote{font-size:12px;color:var(--muted)}.poi-img{will-change:transform;transform-origin:50% 100%;image-rendering:auto;filter:drop-shadow(0 6px 10px rgba(0,0,0,.45));pointer-events:auto;user-select:none}#toast{position:absolute;left:50%;bottom:18px;transform:translateX(-50%);z-index:800;background:rgba(15,22,34,.92);border:1px solid var(--border);border-radius:999px;padding:10px 14px;font-size:13px;color:var(--text);display:none;box-shadow:var(--shadow)}@media (max-width:980px){#app{flex-direction:column}#side{width:100%;max-width:none}#mapWrap{height:62vh}}</style></head><body><div id="app"><div id="mapWrap"><div id="map"></div><div id="logoBadge"><img src="https://raw.githubusercontent.com/EDPAdraseis/diadrastikosxartis/main/Logo%20%CE%95%CE%94%CE%A0%CE%91%20(1000%20x%201000%20px).png" alt="ΕΔΠΑ"/></div><div id="compass" title="Πυξίδα"><div class="needle" id="needle"></div></div><div id="toast"></div></div><aside id="side"><div id="sideHeader"><h2>AI Βοηθός Πάρνηθας</h2><div id="statusPill">έτοιμος</div></div><div class="hint">Πάτα πάνω σε ένα PNG σημείο για πληροφορίες. Με το POI (κωδικός) ανοίγει φόρμα προσθήκης.</div><div class="row"><button id="btnLocate" class="btn-green">Εντοπισμός (GPS)</button><button id="btnFollow" class="btn-blue">Follow: OFF</button><button id="btnMapType" class="btn-blue">Χάρτης: OSM</button><button id="btnStop" class="btn-red">Stop GPS</button><button id="btnPOI" class="btn-yellow">POI (κωδικός)</button></div><div class="hint" style="margin-top:4px;">Τα POI αποθηκεύονται localStorage (προσωρινά).</div><div id="aiBox"><div class="title">Πληροφορίες</div><div class="msg" id="aiMsg">Επίλεξε ένα σημείο (PNG) στον χάρτη για να εμφανιστούν πληροφορίες εδώ.</div><button id="btnDeleteSelected" class="btn-red" style="display:none;width:100%;margin-top:10px;">Διαγραφή POI</button></div></aside></div><div id="modalBackdrop"><div id="modal"><div id="modalHeader"><h3>Προσθήκη POI</h3><button id="closeModal">Κλείσιμο</button></div><div class="field"><label>Κωδικός πρόσβασης</label><input id="poiCode" type="password" placeholder="Πληκτρολόγησε κωδικό"/><div class="smallnote">Ο κωδικός ελέγχεται τοπικά (μέσα στον κώδικα).</div></div><div class="field"><label>Τίτλος</label><input id="poiTitle" type="text" placeholder="π.χ. Άγιος Πέτρος"/></div><div class="field"><label>Περιγραφή (τι να πει ο AI βοηθός)</label><textarea id="poiDesc" placeholder="Γράψε λίγες πληροφορίες..."></textarea></div><div class="field"><label>Latitude, Longitude</label><input id="poiLatLng" type="text" placeholder="π.χ. 38.12345, 23.67890"/><div class="row"><button id="btnPickOnMap" class="btn-blue">Διάλεξε σημείο από χάρτη</button><button id="btnUseGPS" class="btn-green">Βάλε από GPS (αν ενεργό)</button></div><div class="smallnote">Με το “Διάλεξε σημείο” το modal κλείνει πλήρως για να δουλεύει το κλικ.</div></div><div class="field"><label>Όνομα αρχείου (PNG) ή URL</label><input id="poiPng" type="text" placeholder="π.χ. agios_petros.png"/><div class="smallnote">Αν γράψεις σκέτο όνομα, θα το βρω αυτόματα στο GitHub σου!</div></div><div class="field"><label>Μέγεθος POI (S/M/L/XL)</label><div class="row"><label class="chip"><input type="radio" name="poiSize" value="S"> S</label><label class="chip"><input type="radio" name="poiSize" value="M" checked> M</label><label class="chip"><input type="radio" name="poiSize" value="L"> L</label><label class="chip"><input type="radio" name="poiSize" value="XL"> XL</label></div><div class="smallnote">Κάθε POI έχει δικό του size. Με το zoom μεγαλώνουν όλα ανάλογα.</div></div><div class="row" style="justify-content:flex-end;margin-top:12px;"><button id="btnSavePOI" class="btn-green">Αποθήκευση</button></div><div class="smallnote" id="modalNote" style="margin-top:10px;"></div></div></div><script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script><script>const ADMIN_CODE="1234";const STORAGE_KEY="edpa_poi_v12";const GITHUB_BASE="https://raw.githubusercontent.com/EDPAdraseis/diadrastikosxartis/main/";const SIZE_BASE_PX={S:26,M:34,L:44,XL:58};const ICON_BASE_ZOOM=13;const ZOOM_EXP=0.25;const ICON_MIN_SCALE=0.70;const ICON_MAX_SCALE=3.20;function clamp(n,a,b){return Math.max(a,Math.min(b,n))}function toast(msg,ms=1800){const t=document.getElementById("toast");t.textContent=msg;t.style.display="block";clearTimeout(toast._tm);toast._tm=setTimeout(()=>t.style.display="none",ms)}function parseLatLng(str){if(!str)return null;const parts=str.split(",").map(s=>s.trim());if(parts.length!==2)return null;const lat=Number(parts[0]);const lng=Number(parts[1]);if(!Number.isFinite(lat)||!Number.isFinite(lng))return null;return{lat,lng}}function toRawGithubUrl(url){if(!url)return url;const u=url.trim();if(u.match(/^https?:\/\//))return u;if(u.startsWith("./"))return GITHUB_BASE+u.substring(2);return GITHUB_BASE+u}function safeUrl(url){const u=(url||"").trim();if(!u)return"";return toRawGithubUrl(u)}function getSelectedPoiSize(){const el=document.querySelector('input[name="poiSize"]:checked');return el?el.value:"M"}function iconScaleForZoom(z){const pow=Math.pow(2,(z-ICON_BASE_ZOOM)*ZOOM_EXP);return clamp(pow,ICON_MIN_SCALE,ICON_MAX_SCALE)}function calcIconPx(sizeKey){const basePx=SIZE_BASE_PX[sizeKey]||SIZE_BASE_PX.M;const sc=iconScaleForZoom(map.getZoom());const px=Math.round(basePx*sc);return clamp(px,18,140)}function makePngDivIcon(pngUrl,sizeKey){const px=calcIconPx(sizeKey);const html='<img class="poi-img" src="'+pngUrl+'" style="width:'+px+'px;height:auto;" draggable="false" />';return L.divIcon({className:"",html,iconSize:[px,px],iconAnchor:[Math.round(px/2),px]})}const map=L.map("map",{zoomControl:true}).setView([38.157,23.742],12);const mapLayers=[{name:"Χάρτης: OSM",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attr:"&copy; OpenStreetMap"},{name:"Χάρτης: Δορυφ.",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attr:"&copy; Esri"},{name:"Χάρτης: Βουνό",url:"https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",attr:"&copy; OpenTopoMap"}];let currentMapIdx=0;let currentTileLayer=L.tileLayer(mapLayers[0].url,{maxZoom:19,attribution:mapLayers[0].attr}).addTo(map);document.getElementById("btnMapType").addEventListener("click",()=>{currentMapIdx=(currentMapIdx+1)%mapLayers.length;const info=mapLayers[currentMapIdx];map.removeLayer(currentTileLayer);currentTileLayer=L.tileLayer(info.url,{maxZoom:19,attribution:info.attr}).addTo(map);document.getElementById("btnMapType").textContent=info.name;toast("Αλλαγή σε: "+info.name)});const needle=document.getElementById("needle");if(window.DeviceOrientationEvent){window.addEventListener("deviceorientation",(e)=>{const a=(typeof e.alpha==="number")?e.alpha:null;if(a===null)return;needle.style.transform="rotate("+(-a)+"deg)"},true)}let watchId=null;let followOn=false;let lastPos=null;const gpsMarker=L.circleMarker([0,0],{radius:7,weight:2,color:"#2cff8f",fillColor:"#2cff8f",fillOpacity:0.25});const gpsAccuracy=L.circle([0,0],{weight:1,color:"#2cff8f",fillColor:"#2cff8f",fillOpacity:0.08});function setStatus(t){document.getElementById("statusPill").textContent=t}function startGPS(){if(!navigator.geolocation){toast("Το GPS δεν υποστηρίζεται εδώ.");return}stopGPS(false);watchId=navigator.geolocation.watchPosition((pos)=>{const lat=pos.coords.latitude;const lng=pos.coords.longitude;const acc=pos.coords.accuracy||0;lastPos={lat,lng};gpsMarker.setLatLng([lat,lng]);gpsAccuracy.setLatLng([lat,lng]);gpsAccuracy.setRadius(acc);if(!map.hasLayer(gpsMarker))gpsMarker.addTo(map);if(!map.hasLayer(gpsAccuracy))gpsAccuracy.addTo(map);if(followOn)map.setView([lat,lng],Math.max(map.getZoom(),15),{animate:true});setStatus("GPS OK")},(err)=>{toast("GPS error: "+err.message);setStatus("GPS error")},{enableHighAccuracy:true,maximumAge:1000,timeout:15000});toast("GPS ενεργό")}function stopGPS(showToast=true){if(watchId!==null){navigator.geolocation.clearWatch(watchId);watchId=null}followOn=false;document.getElementById("btnFollow").textContent="Follow: OFF";if(map.hasLayer(gpsMarker))map.removeLayer(gpsMarker);if(map.hasLayer(gpsAccuracy))map.removeLayer(gpsAccuracy);if(showToast)toast("GPS stopped");setStatus("έτοιμος")}document.getElementById("btnLocate").addEventListener("click",startGPS);document.getElementById("btnStop").addEventListener("click",()=>stopGPS(true));document.getElementById("btnFollow").addEventListener("click",()=>{followOn=!followOn;document.getElementById("btnFollow").textContent="Follow: "+(followOn?"ON":"OFF");if(followOn&&lastPos){map.setView([lastPos.lat,lastPos.lng],Math.max(map.getZoom(),15),{animate:true})}});const aiMsg=document.getElementById("aiMsg");const btnDelSel=document.getElementById("btnDeleteSelected");let selectedPoiId=null;function mockAIResponse(poi){return"Τίτλος: "+poi.title+"\n\n"+(poi.desc||"Χωρίς περιγραφή ακόμα.")}let poiMarkers=[];function loadPOIs(){try{const raw=localStorage.getItem(STORAGE_KEY);if(!raw)return[];const arr=JSON.parse(raw);return Array.isArray(arr)?arr:[]}catch(e){return[]}}function savePOIs(arr){localStorage.setItem(STORAGE_KEY,JSON.stringify(arr))}function renderPOIs(){poiMarkers.forEach(x=>map.removeLayer(x.marker));poiMarkers=[];const pois=loadPOIs();pois.forEach(poi=>{const png=safeUrl(poi.png);const sizeKey=poi.sizeKey||"M";const marker=L.marker([poi.lat,poi.lng],{icon:makePngDivIcon(png,sizeKey),riseOnHover:true}).addTo(map);marker.on("click",()=>{aiMsg.textContent=mockAIResponse(poi);selectedPoiId=poi.id;btnDelSel.style.display="block"});poiMarkers.push({id:poi.id,marker})})}function updateAllMarkerSizes(){const pois=loadPOIs();const byId=new Map(pois.map(p=>[p.id,p]));poiMarkers.forEach(x=>{const poi=byId.get(x.id);if(!poi)return;const png=safeUrl(poi.png);x.marker.setIcon(makePngDivIcon(png,poi.sizeKey||"M"))})}map.on("zoomend",()=>{updateAllMarkerSizes()});map.on("click",(e)=>{if(!pickingMode){selectedPoiId=null;btnDelSel.style.display="none";aiMsg.textContent="Επίλεξε ένα σημείο (PNG) στον χάρτη για πληροφορίες."}});btnDelSel.addEventListener("click",()=>{if(!selectedPoiId)return;if(!confirm("Σίγουρα διαγραφή αυτού του POI;"))return;let pois=loadPOIs();pois=pois.filter(p=>p.id!==selectedPoiId);savePOIs(pois);selectedPoiId=null;btnDelSel.style.display="none";aiMsg.textContent="Διαγράφηκε.";renderPOIs();toast("POI διαγράφηκε")});const modalBackdrop=document.getElementById("modalBackdrop");const closeModalBtn=document.getElementById("closeModal");function openModal(){document.getElementById("modalNote").textContent="";modalBackdrop.style.display="flex";modalBackdrop.style.pointerEvents="auto"}function closeModal(){modalBackdrop.style.display="none";modalBackdrop.style.pointerEvents="none"}closeModalBtn.addEventListener("click",()=>{pickingMode=false;closeModal()});modalBackdrop.addEventListener("click",(e)=>{if(e.target===modalBackdrop){pickingMode=false;closeModal()}});document.getElementById("btnPOI").addEventListener("click",openModal);let pickingMode=false;document.getElementById("btnPickOnMap").addEventListener("click",()=>{pickingMode=true;closeModal();toast("Κλικ στον χάρτη για συντεταγμένες",2200);setStatus("pick mode")});map.on("click",(e)=>{if(!pickingMode)return;pickingMode=false;openModal();const lat=e.latlng.lat.toFixed(6);const lng=e.latlng.lng.toFixed(6);document.getElementById("poiLatLng").value=lat+", "+lng;document.getElementById("modalNote").textContent="OK, πήρα συντεταγμένες από χάρτη.";setStatus("έτοιμος")});document.getElementById("btnUseGPS").addEventListener("click",()=>{if(!lastPos){document.getElementById("modalNote").textContent="Δεν υπάρχει GPS θέση ακόμα. Πάτα Εντοπισμός (GPS).";return}document.getElementById("poiLatLng").value=lastPos.lat.toFixed(6)+", "+lastPos.lng.toFixed(6);document.getElementById("modalNote").textContent="OK, πήρα συντεταγμένες από GPS."});document.getElementById("btnSavePOI").addEventListener("click",()=>{const code=(document.getElementById("poiCode").value||"").trim();if(code!==ADMIN_CODE){document.getElementById("modalNote").textContent="Λάθος κωδικός.";return}const title=(document.getElementById("poiTitle").value||"").trim();const desc=(document.getElementById("poiDesc").value||"").trim();const latlng=parseLatLng(document.getElementById("poiLatLng").value);const pngIn=(document.getElementById("poiPng").value||"").trim();const sizeKey=getSelectedPoiSize();if(!title){document.getElementById("modalNote").textContent="Θέλει τίτλο.";return}if(!latlng){document.getElementById("modalNote").textContent="Βάλε σωστά Latitude, Longitude.";return}if(!pngIn){document.getElementById("modalNote").textContent="Βάλε PNG URL (ή ./filename.png).";return}const png=safeUrl(pngIn);const arr=loadPOIs();const poi={id:"poi_"+Date.now(),title,desc,lat:latlng.lat,lng:latlng.lng,png,sizeKey};arr.push(poi);savePOIs(arr);renderPOIs();updateAllMarkerSizes();toast("POI saved");closeModal();pickingMode=false});document.getElementById("btnLocate").addEventListener("click",startGPS);renderPOIs()</script></body></html>